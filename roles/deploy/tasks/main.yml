- name: Create main directory
  file:
    path:   "{{ remote_directory }}"
    state:  directory

- name: Synchronize static files
  synchronize:
    src:        .
    dest:       "{{ remote_directory }}/files"
    recursive:  true
    delete:     true
    perms:      true

# - name: Create globalrc directory structure
#   file:
#     state: directory
#     dest: '{{ remote_directory }}/{{ item.path }}'
#   with_filetree: '../templates/globalrc'
#   when: item.state == 'directory'
# 
# - name: Copy globalrc files
#   template:
#     src: '{{ item.src }}'
#     dest: '{{ remote_directory }}/{{ item.path }}'
#   with_filetree: '../templates/globalrc'
#   when: item.state == 'file'

- name: Setup the loading via .bashrc
  blockinfile:
    dest:   ~/.bashrc
    block:  |
      # Load custom configuration
      . {{ remote_directory }}/files/bash/bashrc

- name: Setup the loading via .zshrc
  blockinfile:
    dest:   ~/.zshrc
    block:  |
      # Load custom configuration
      . {{ remote_directory }}/files/zsh/zshrc

- name: Try to set zsh as default shell
  user:
    name:   "{{ ansible_user_id }}"
    shell:  /bin/zsh
  ignore_errors: true

